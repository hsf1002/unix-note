### 第十五章  进程间通信

##### 引言

```
IPC类型

半双工管道
FIFO
全双工管道
命名全双工管道
XSI信号量
XSI消息队列
XSI共享存储
消息队列(实时)
信号量
共享存储(实时)
套接字
STREAMS
```

##### 管道

局限：

* 历史上，实现为半双工，虽然有些系统提供全双工管道
* 只能在具有公共祖先的两个进程之间使用，通常是在fork之后的父进程和子进程之间使用

FIFO没有第二种局限，域套接字没有这这两种局限，尽管如此，半双工管道仍然是最常用的IPC形式

```
#include <unistd.h>

int pipe(int fd[2]);	
// 若成功，返回0，若出错，返回-1
```

fd[0]为读打开，fd[1]为写打开，fd[1]的输出是fd[0]的输入

单个进程的管道几乎没有任何作用，通常，进程先调用pipe，再fork，从而创建从父进程到子进程的IPC通道；从父进程->子进程的管道，父进程关闭读端，子进程关闭写端，从子进程->父进程的管道，则相反；当管道的一端被关闭后，以下两条规则起作用：

1. 当读一个写端已被关闭的管道时，所有数据被读取后，read返回0，表示文件结束
2. 当写一个读端已被关闭的管道时，则产生信号SIGPIPE，若忽略此信号或从信号处理函数返回，write返回-1，errno设置为EPIPE

常量PIPE_BUF规定了内核的管道缓冲区大小，可以用pathconf或fpathconf确定

